# forticare-api

Proof of concept python3 scripts using the FortiCare API to register Fortinet
registration codes and to retrieve license files.

# Before starting

Create in your working directory a `.forticare` in INI format as shown below

```
[forticare]
url = https://Support.Fortinet.COM/ES/FCWS_RegistrationService.svc/REST
token = NZTB-630M-OLYE-PPKG-4WWM-TL2A-WLZ2-0DJU
```
# Create a CSV file

It should have the following format:

```
# Use the '#' sign to comment a line
<registration_key>,<ip address>,<description>
```

For instance:

```
C6G36-V7TT7-DAE15-4EZ8T-U531B,192.168.244.200,FMG: SD-WAN orchestrator demo
D0UAB-FWEU6-MQ6A5-EVXZH-GHB1W,192.168.244.200,FMG: SD-WAN orchestrator demo
```

We are providing a CSV generator to produce the CSV file out of the ZIP file we
receive from Fortinet when ordering our products.
The above CSV output has been generated by using the following command line:

```
$ ./generate_csv.py -f FMG-VM-BASE_27228669.zip -d "FMG: SD-WAN orchestrator demo" --ip '192.168.244.200'
PdfReadWarning: PdfFileReader stream/file object is not in binary mode. It may not be read correctly. [pdf.py:1079]
C6G36-V7TX7-DAE15-4EZ9T-U531B,192.168.244.200,FMG: SD-WAN orchestrator demo
D0UAB-FWEX6-MQ6A5-EVX8H-GHB1W,192.168.244.200,FMG: SD-WAN orchestrator demo
```

Notes:

  [1] For the moment, the CSV generator has been tested against ZIP files for
      FGT-VM, FMG-VM and FAZ-VM products.
  [2] Ignore the *PdfReadWarning* error.

So to generate a CSV file just redirect the output to a file:

```
$ ./generate_csv.py -f FMG-VM-BASE_27228669.zip -d "FMG: SD-WAN orchestrator demo" --ip '192.168.244.200' > fmg.csv
````

# Register your liceses

We can just use the shell script `register.sh`:

```
$ ./register.sh -f fmg.csv
```

The script shell is taking care of saving the license file (when FortiCare
returns one) in a file named `<sn>.lic`.

# How to add Service Entitlement on registered products?

## Generate the CSV file for the FortiGate VM licenses

```
$ ./generate_csv.py -f FG-VMUL_27228668.zip -i '' -d 'FG-VMUL: SD-WAN Orchestrator demo" > fgt.csv
```

## Generate the FortiGate VM licenses

```
$ ./register.sh -f fgt.csv
```

## Create a folder for all generated FortiGate VM licenses

```
$ mkdir fgt_licenses
```

## Move generated FortiGate VM licenses in this folder

```
$ mv FG*.lic fgt_licenses
```

## Generate the CSV file for the Service Entitlements

```
$ ./generate_csv.py -f FC-10-FVMUL-819-02-12_27237843.zip -i '' -d '365 Bundle: SD-WAN Orchestrator demo' -l fgt_licenses > fc.csv
```

Double check that all lines of this CSV is having a code (first field) and a
corresponding serial number (last field).

For instance:

```
[...]
0022TV383064,,365 Bundle: SD-WAN Orchestrator demo,FGVMULTM21223222
[...]
```

## Generate the Service Entitlemnets

```
$ ./register.sh -f fc.csv
```
